import Head from "next/head";
import { Layout } from "../../components/profile/layout";
import { LayoutPage } from "../../types";
import "react-toastify/dist/ReactToastify.css";
import { AgreementList } from "../../components/lists/agreementList/agreementList";
import { AvtaleGiroAgreement, Donation, VippsAgreement } from "../../models";
import { useApi } from "../../hooks/useApi";
import { Spinner } from "../../components/elements/spinner";
import { useAuth0 } from "@auth0/auth0-react";

const Agreements: LayoutPage = () => {
  const { getAccessTokenSilently, user } = useAuth0();

  const {
    loading: avtaleGiroLoading,
    data: avtaleGiro,
    error: avtaleGiroError,
  } = useApi<AvtaleGiroAgreement[]>(
    `/donors/${
      user ? user["https://konduit.no/user-id"] : ""
    }/recurring/avtalegiro/`,
    "GET",
    "read:donations",
    getAccessTokenSilently
  );

  const {
    loading: vippsLoading,
    data: vipps,
    error: vippsError,
  } = useApi<VippsAgreement[]>(
    `/donors/${
      user ? user["https://konduit.no/user-id"] : ""
    }/recurring/vipps/`,
    "GET",
    "read:donations",
    getAccessTokenSilently
  );

  if (vippsLoading || avtaleGiroLoading || !vipps || !avtaleGiro)
    return <Spinner />;

  return (
    <>
      <Head>
        <title>Avtaler</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div>
        <h1>Faste avtaler</h1>

        <AgreementList
          title={"Aktive"}
          vipps={vipps}
          avtalegiro={avtaleGiro}
          supplemental={"Dette er dine aktive betalingsavtaler du har med oss"}
        />
        <AgreementList
          title={"Inaktive"}
          vipps={vipps}
          avtalegiro={avtaleGiro}
          supplemental={
            "Dette er tidligere faste betalingsavtaler du har hatt med oss, som vi ikke lenger trekker deg for"
          }
        />
      </div>
    </>
  );
};

Agreements.layout = Layout;
export default Agreements;
