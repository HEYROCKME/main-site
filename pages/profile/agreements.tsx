import Head from "next/head";
import { Layout } from "../../components/profile/layout";
import { ProfileInfo } from "../../components/profile/profileInfo";
import { DataInfo } from "../../components/profile/dataInfo";
import style from "../../styles/Profile.module.css";
import { LayoutPage } from "../../types";
import "react-toastify/dist/ReactToastify.css";
import { useRouter } from "next/router";
import { getClient } from "../../lib/sanity.server";
import { groq } from "next-sanity";
import { AgreementList } from "../../components/lists/agreementList/agreementList";
import { AvtaleGiroAgreement, Donation, VippsAgreement } from "../../models";
import { useApi } from "../../hooks/useApi";
import { Spinner } from "../../components/elements/spinner";
import { useAuth0 } from "@auth0/auth0-react";

const Agreements: LayoutPage = () => {
  // const agreements: (AvtaleGiroAgreement | VippsAgreement)[] = [
  //   {
  //     ID: 18,
  //     active: true,
  //     amount: 100000,
  //     KID: "0000123",
  //     payment_date: 5,
  //     created: "string",
  //     last_updated: "string",
  //     notice: true,
  //     full_name: "Håkon Harnes",
  //   },
  //   {
  //     ID: 15,
  //     status: true,
  //     donorID: 27,
  //     full_name: "Håkon Harnes",
  //     KID: "0001213",
  //     timestamp_created: "string",
  //     monthly_charge_day: 10,
  //     force_charge_date: true,
  //     paused_until_date: "string",
  //     amount: 5000,
  //     agreement_url_code: "string",
  //   },
  // ];
  const { getAccessTokenSilently, user } = useAuth0();

  const {
    loading: avtalegiroLoading,
    data: avtalegiro,
    error: avtalegiroError,
  } = useApi<AvtaleGiroAgreement[]>(
    `/donors/${user ? user["https://konduit.no/user-id"] : ""}/recurring/avtalegiro/`,
    "GET",
    "read:donations",
    getAccessTokenSilently
  );

  const {
    loading: vippsLoading,
    data: vipps,
    error: vippsError,
  } = useApi<VippsAgreement[]>(
    `/donors/${user ? user["https://konduit.no/user-id"] : ""}/recurring/vipps/`,
    "GET",
    "read:donations",
    getAccessTokenSilently
  );

  if (vippsLoading || avtalegiroLoading || !vipps || !avtalegiro)
  return <Spinner />

  return (
    <>
      <Head>
        <title>Avtaler</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div>
        <h1>Faste avtaler</h1>

        <AgreementList
          title={"Aktive"}
          agreements={agreements}
          supplemental={"Dette er dine aktive betalingsavtaler du har med oss"}
        />
        <AgreementList
          title={"Inaktive"}
          agreements={agreements}
          supplemental={
            "Dette er tidligere faste betalingsavtaler du har hatt med oss, som vi ikke lenger trekker deg for"
          }
        />
      </div>
    </>
  );
};

Agreements.layout = Layout;
export default Agreements;
